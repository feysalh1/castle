<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Child Login - Children's Castle</title>
<link href="/css/style.css" rel="stylesheet"/>
<link href="/css/account.css" rel="stylesheet"/>
<link href="/css/loading-animations.css" rel="stylesheet"/>
<style>
        .pin-toggle {
            margin-top: 10px;
            text-align: center;
        }
        .pin-toggle label {
            cursor: pointer;
            color: #4a6da7;
        }
        .pin-toggle label:hover {
            text-decoration: underline;
        }
        .pin-number-display {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 40px;
            font-size: 24px;
            font-weight: bold;
            color: #4a6da7;
            margin-bottom: 10px;
            visibility: visible;
        }
        .pin-number-display.visible {
            visibility: visible;
        }
        
        /* Child selection styles */
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .avatar-option {
            cursor: pointer;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.2s;
            border: 3px solid transparent;
        }
        
        .avatar-option:hover {
            background-color: rgba(74, 109, 167, 0.1);
        }
        
        .avatar-option.selected {
            border-color: #4a6da7;
            background-color: rgba(74, 109, 167, 0.1);
        }
        
        .avatar-option img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 8px;
        }
        
        .avatar-option p {
            font-weight: bold;
            color: #4a6da7;
            margin: 5px 0 0 0;
        }
    </style>
<script type="module">
            // Import the functions you need from the SDKs
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
            
            // Firebase configuration with environment variable placeholders
            const firebaseConfig = {
                apiKey: "kingcastle-e2031",
                authDomain: "story-time-fun.firebaseapp.com",
                projectId: "story-time-fun",
                storageBucket: "story-time-fun.firebasestorage.app",
                messagingSenderId: "225122848236",
                appId: "AIzaSyCyWHkto_qaRWNiRIsltlBICkJai3u_VTvc",
            };
            
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            
            // Redirect to login if not authenticated (for protected pages)
            if ("REQUIRE_AUTH" === "true") {
                auth.onAuthStateChanged(user => {
                    if (!user && window.location.pathname !== '/index.html' && window.location.pathname !== '/') {
                        window.location.href = '/index.html';
                    }
                });
            }
        </script></head>
<body>
<header>
<div class="container">
<div class="logo">
<!-- Title removed -->
</div>
<nav>
<a href="/">Home</a>
<a href="/parent-login.html">Parent Login</a>
</nav>
</div>
</header>
<main>
<div class="container">
<!-- Flash Messages -->
<div class="flash-messages">
</div>
<div class="auth-container">
<div class="auth-header">
<h2>Child Login</h2>
<p>Select your character and enter your PIN to start playing!</p>
</div>
<form action="/child/login" class="auth-form" id="childLoginForm" method="POST">
<!-- CSRF Token -->
<div class="form-group">
<label for="username">Select Your Character</label>
<input id="username" name="username" type="hidden"/>
<div class="avatar-selection" id="children-selection">
</div>
</div>
<div class="form-group">
<label for="pin">PIN Code</label>
<input id="pin" name="pin" required="" type="password"/>
</div>
<div class="pin-container">
<div class="pin-number-display" id="pinNumberDisplay"></div>
<div class="pin-display">
<div class="pin-dot" id="dot1"></div>
<div class="pin-dot" id="dot2"></div>
<div class="pin-dot" id="dot3"></div>
<div class="pin-dot" id="dot4"></div>
</div>
<div class="pin-toggle">
<label><input checked="" id="showPin" onchange="togglePinVisibility()" type="checkbox"/> Show PIN</label>
</div>
<div class="pin-pad">
<button class="pin-button" onclick="addPin(1)" type="button">1</button>
<button class="pin-button" onclick="addPin(2)" type="button">2</button>
<button class="pin-button" onclick="addPin(3)" type="button">3</button>
<button class="pin-button" onclick="addPin(4)" type="button">4</button>
<button class="pin-button" onclick="addPin(5)" type="button">5</button>
<button class="pin-button" onclick="addPin(6)" type="button">6</button>
<button class="pin-button" onclick="addPin(7)" type="button">7</button>
<button class="pin-button" onclick="addPin(8)" type="button">8</button>
<button class="pin-button" onclick="addPin(9)" type="button">9</button>
<button class="pin-button" style="visibility: hidden;" type="button"></button>
<button class="pin-button" onclick="addPin(0)" type="button">0</button>
<button class="pin-button" onclick="submitPin()" type="button">✓</button>
</div>
<div class="pin-actions">
<span class="pin-clear" onclick="clearPin()">Clear PIN</span>
</div>
</div>
</form>
<div class="auth-links">
<p>Are you a parent? <a href="/parent-login.html">Login here</a></p>
</div>
</div>
</div>
</main>
<footer>
<div class="container">
<p>© 2025 Children's Castle. All rights reserved.copy; 2025. All rights reserved.</p>
</div>
</footer>
<script>
        let currentPin = '';
        let showingPin = true;
        
        // Child selection
        const avatarOptions = document.querySelectorAll('.avatar-option');
        const usernameInput = document.getElementById('username');
        
        avatarOptions.forEach(option => {
            option.addEventListener('click', function() {
                // Remove selected class from all options
                avatarOptions.forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to clicked option
                this.classList.add('selected');
                
                // Update hidden input value
                usernameInput.value = this.getAttribute('data-username');
            });
        });
        
        function addPin(number) {
            if (currentPin.length < 4) {
                currentPin += number;
                updatePinDisplay();
                
                if (currentPin.length === 4) {
                    // Auto submit after 4 digits
                    setTimeout(submitPin, 300);
                }
            }
        }
        
        function clearPin() {
            currentPin = '';
            updatePinDisplay();
        }
        
        function updatePinDisplay() {
            // Update dots
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById(`dot${i}`);
                dot.classList.toggle('filled', i <= currentPin.length);
            }
            
            // Update pin number display
            document.getElementById('pinNumberDisplay').textContent = currentPin;
            
            // Update hidden input
            document.getElementById('pin').value = currentPin;
        }
        
        // Set PIN visibility on by default
        document.getElementById("showPin").checked = true;
        document.getElementById("pinNumberDisplay").classList.add("visible");
        
        function togglePinVisibility() {
            showingPin = document.getElementById('showPin').checked;
            const pinDisplay = document.getElementById('pinNumberDisplay');
            
            if (showingPin) {
                pinDisplay.classList.add('visible');
            } else {
                pinDisplay.classList.remove('visible');
            }
        }
        
        function submitPin() {
            if (currentPin.length === 4 && usernameInput.value) {
                document.getElementById('childLoginForm').submit();
            } else if (!usernameInput.value) {
                alert('Please select your character first!');
            }
        }
        
        // Initialize
        updatePinDisplay();
    </script>
<script src="/js/loading-animations.js"></script>
<script>
            // Firebase adapter for static hosting
            window.handleFirebaseAction = function(action, returnUrl) {
                // In the static deployment, log actions rather than performing them
                console.log('Firebase action:', action);
                
                // For demonstration, simulate the action feedback
                alert('This would perform ' + action + ' in the full application.');
                
                // For login/logout, simulate the navigation
                if (action === 'login') {
                    window.location.href = returnUrl || '/story-mode.html';
                } else if (action === 'logout') {
                    window.location.href = '/index.html';
                }
                
                return false; // Prevent form submission
            };
        </script></body>
</html>